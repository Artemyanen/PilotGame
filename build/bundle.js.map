{"version":3,"sources":["index.ts"],"names":[],"mappings":"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","file":"","sourcesContent":["import * as _ from 'underscore';\r\n\r\ninterface IObject\r\n{\r\n    x:number,\r\n    y:number,\r\n    color:string\r\n}\r\n\r\nclass Block implements IObject\r\n{\r\n    x: number;\r\n    y: number;\r\n    color:string;\r\n    height:number = 64;\r\n    width:number = 64;\r\n    neigh = [];\r\n    remove:boolean;\r\n\r\n    constructor(x, y, color)\r\n    {\r\n        this.color = color;\r\n        this.x = x;\r\n        this.y = y;\r\n        this.remove = false;\r\n    }\r\n\r\n    getNeightbours()\r\n    {\r\n        const x = this.x;\r\n        const y = this.y;\r\n        return [\r\n            getObjectsIn(x,y-64)[0],\r\n            getObjectsIn(x,y+64)[0],\r\n            getObjectsIn(x-64,y)[0],\r\n            getObjectsIn(x+64,y)[0]].filter(q=>q);\r\n    }\r\n    isDownPlaceEmpty()\r\n    {\r\n        if(getObjectsIn(this.x,this.y+64)[0] == undefined && this.y < canvas.height-this.height)\r\n            return true\r\n        return false;\r\n    }\r\n\r\n    update()\r\n    {\r\n        if(this.isDownPlaceEmpty())\r\n            this.y += 16;\r\n    }\r\n\r\n}\r\n\r\nconst canvas = document.getElementById('MyCanvas');\r\nconst context = canvas.getContext('2d');\r\n\r\nlet dt:number;\r\nlet lastTime:number = 0;\r\nlet gameObjects:Block[] = [];\r\n\r\nconst pulse = (millis):void => {\r\n    if(lastTime!=null && lastTime)\r\n        {\r\n            dt = ((millis - lastTime) / 1000);\r\n            update();\r\n        }\r\n    lastTime = millis;\r\n    window.requestAnimationFrame(pulse);\r\n}\r\n\r\n\r\nconst update = () => {\r\n    gameObjects = gameObjects.filter(q=>q.remove == false);\r\n\r\n    gameObjects.forEach(object=>object.update());\r\n\r\n    context.clearRect(0,0,canvas.width,canvas.height);\r\n    gameObjects.forEach((object,ind)=>{\r\n        context.fillStyle = object.color;\r\n        context.fillRect(object.x, object.y, object.height, object.width);\r\n    });\r\n}\r\n\r\nconst getRandomColor = ():string =>\r\n{\r\n    const colors = ['red','green','blue'];\r\n    let random = Math.floor(Math.random()*3);\r\n    return colors[random];\r\n}\r\n\r\nconst createNewLine = () => {\r\n    const size = 64;\r\n    let y = canvas.height;\r\n    for(let _i = 0; _i < 4; _i++)\r\n        gameObjects.push(new Block(size*_i, y, getRandomColor()));\r\n}\r\n\r\nconst upOldLines = () => {\r\n    gameObjects.forEach((block)=>{\r\n        block.y -= 64;\r\n    });\r\n}\r\n\r\nconst bfs = (startBlock:Block) => \r\n{\r\n    let checked :Block[]= [];\r\n    let queue :Block[]= [];\r\n    let current :Block;\r\n    queue.push(startBlock);\r\n    checked.push(startBlock);\r\n    while (queue.length) {\r\n        current = queue.shift();\r\n        current\r\n            .getNeightbours()\r\n            .filter(neigh=>neigh.color == current.color)\r\n            .forEach(neigh=>{\r\n                if(checked.indexOf(neigh) == -1) \r\n                {\r\n                    queue.push(neigh);\r\n                    checked.push(neigh);\r\n                }\r\n            });\r\n    }\r\n    return checked;\r\n};\r\n\r\nconst isTripleAvailable = (objects:Block[]) =>\r\n{\r\n    return _.chain(objects)\r\n    .filter(val=>val.remove==false)\r\n    .map(val=> bfs(val))\r\n    .filter(q=>q.length > 2 && (rowCountMatch(q[0],3,Direction.Horizontal) || rowCountMatch(q[0],3,Direction.Vertical)))\r\n    .map(val=>_.chain(val).sortBy(q=>q.x).sortBy(q=>q.y).value())\r\n    .groupBy(q=>q[0].x + \"|\" +q[0].y).map(q=>q[0]).value().length > 0;\r\n}\r\n\r\nconst sortObjects = (a:Block,b:Block) : number=>\r\n{\r\n    return a.x == b.x && a.y == b.y && a.color == b.color ? 1 :0;\r\n}\r\n\r\nconst rowCountMatch = (block:Block,blocksInRowCount:number,direction:Direction) =>\r\n{\r\n    let result:Block[] = [];\r\n    new Array(blocksInRowCount)\r\n    .fill('x')\r\n    .forEach((_,ind)=>\r\n    {\r\n        let obj : Block;\r\n        if(direction == Direction.Horizontal)\r\n            obj = getObjectsIn(block.x+(ind*block.width),block.y)[0];\r\n        else\r\n            obj = getObjectsIn(block.x,block.y+(ind*block.height))[0];\r\n        if(obj && obj.color == block.color)\r\n            result.push(obj);\r\n        else\r\n            return false;\r\n    });\r\n    return result.length == blocksInRowCount;\r\n}\r\n\r\nenum Direction\r\n{\r\n    Vertical,\r\n    Horizontal\r\n}\r\n\r\nconst getObjectsIn = (x:number,y:number) =>\r\n{\r\n    return gameObjects.filter((object)=>(y >= object.y && y < object.y + object.height\r\n        && x >= object.x && x < object.x + object.width));\r\n}\r\n\r\n// let canClick = true;\r\nlet canvasLeftOffset = canvas.offsetLeft;\r\nlet canvasToptOffset = canvas.offsetTop;\r\ndocument.addEventListener('click', (event)=>{\r\n    const x = event.pageX - canvasLeftOffset;\r\n    const y = event.pageY - canvasToptOffset;\r\n    // if(canClick == false)\r\n    //     return;\r\n    // canClick = false;\r\n    const clickedObject = getObjectsIn(x, y)[0];\r\n    // if(!clickedObject)\r\n    //     return;\r\n    const sameColors = bfs(clickedObject);\r\n    sameColors.forEach((val,ind)=>val.remove = true);\r\n    // createNewLine();\r\n    // upOldLines();\r\n    isTripleAvailable(gameObjects)\r\n    \r\n\r\n    // canClick = true;\r\n});\r\n\r\nnew Array(6).fill(0).forEach(()=>\r\n{\r\n    createNewLine();\r\n    upOldLines();\r\n})\r\n\r\npulse(null);"]}